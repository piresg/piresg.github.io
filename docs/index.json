[{"content":"Definição LLMNR é um acrónimo de Link-Local Multicast Resolution, está activo por defeito e é usado para resolução de nomes quando não existe resposta do DNS ao pedido.\nNa pratica é enviado, em ultimo recurso, um pedido para todo o segmento de rede onde a máquina se encontra na tentativa que o pedido seja respondido por alguem que consiga resolver o nome.\nA vulnerabilidade deste serviço existe na resposta, sendo enviado o utilizador e a hash da password que pode assim ser extraida dependendo da complexidade da mesma.\nÉ um ataque do tipo Man in the Middle (MITM), em que o atacante responde ao pedido e guarda informação de acesso do utilizador.\nO utilizador pretende aceder a uma pasta de rede inexistente com o nome \\\\ZEMANEL; O DNS falha em responder porque não conhece o recurso; É enviado para a rede o mesmo pedido por LLMNR; A maquina do atacante diz que tem o recurso localmente; É enviado o user e o hash da password para o atacante para que inicie a autenticação. Desta forma o atacante fica com a possibilidade de extrair a password do hash que recebeu para se autenticar, iniciando assim o primeiro passo para acesso ao dominio.\nExploração (PoC) Iniciar o responder sudo responder -I eth0 -wd o utilizador tenta aceder a uma pasta de rede que não existe. O responder indica ao utilizador jcid dizendo que é ele o destino e é enviado o user e a hash da password Copiamos a hash para um ficheiro e iniciamos o processo de extração da password a partir da hash. Iremos utilizar a ferramenta hashcat para o efeito, existem outras opções como o John the ripper\nO tipo de hash é NTLMV2\nhashcat -m 5600 jcid.hash /usr/share/wordlists/rockyou.txt E a partir deste momento já conhecemos o user/dominio assim como a password do utilizador, neste ponto podemos iniciar a exploração da Active Directory, visto que já temos credenciais validas.\nInformação adicional Este tipo de ataque é muito eficaz logo pelo manhã quando os utilizadores chegam ao local de trabalho e depois de almoço. Visto que nessa altura é quando estes começam a aceder a drives partilhadas e/ou a outros serviços.\nMitigação Em \u0026ldquo;Group Policy Editor\u0026rdquo; \u0026gt; Local Computer Policy \u0026gt; Computer Configuration \u0026gt; Administrative Templates \u0026gt; Network \u0026gt; DNS Client colocar \u0026ldquo;Turn OFF Multicast Name Resolution\u0026rdquo; como enable. ","permalink":"https://www.insecure.pt/posts/ad_llmnr/","summary":"Definição LLMNR é um acrónimo de Link-Local Multicast Resolution, está activo por defeito e é usado para resolução de nomes quando não existe resposta do DNS ao pedido.\nNa pratica é enviado, em ultimo recurso, um pedido para todo o segmento de rede onde a máquina se encontra na tentativa que o pedido seja respondido por alguem que consiga resolver o nome.\nA vulnerabilidade deste serviço existe na resposta, sendo enviado o utilizador e a hash da password que pode assim ser extraida dependendo da complexidade da mesma.","title":"LLMNR Poisoning"},{"content":"Definição Em vez de capturarmos as hashes e tentarmos extrair a password podendo não existir sucesso devido à sua complexidade. Este ataque usa a hash capturada e encaminha para ganhar acesso noutra maquina, fazendo relay da hash. Em caso de sucesso este ataque é usado para movimentação lateral dentro de um dominio.\nCenário O cenário é constituido por duas workstations em que o utilizador José Cid é local administrator nas duas maquinas (WS01 e WS02). O SMB Signing encontra-se desabilitado.\nRequisitos Para que este ataque seja possivel, o ambiente tem de ter os seguintes requisitos:\nSMB Signing disabled; O utilizador tem de ser administrator local das maquinas envolvidas. Enumeração SMB Signing Disabled O primeiro passo é verificar se o SMB Signing está inactivo e para isso usaremos o nmap com o comando abaixo:\nnmap -Pn --script=smb2-security-mode.nse -p 445 \u0026lt;IP\u0026gt; ou\nnmap -Pn --script=smb2-security-mode.nse -p 445 \u0026lt;IP\u0026gt;/\u0026lt;CIDR\u0026gt; Podemos verificar que está activo mas não obrigatório o seu uso.\nExploração (PoC) Configuração do responder Como o objectivo é reenviar a hash que iremos receber para outra workstation iremos configurar o responder . Teremos que desabilitar\nsudo vi /etc/responder/Responder.conf sudo responder -I eth0 -wdv ","permalink":"https://www.insecure.pt/posts/ad_smbrelay/","summary":"Definição Em vez de capturarmos as hashes e tentarmos extrair a password podendo não existir sucesso devido à sua complexidade. Este ataque usa a hash capturada e encaminha para ganhar acesso noutra maquina, fazendo relay da hash. Em caso de sucesso este ataque é usado para movimentação lateral dentro de um dominio.\nCenário O cenário é constituido por duas workstations em que o utilizador José Cid é local administrator nas duas maquinas (WS01 e WS02).","title":"SMB Relay Attack"}]